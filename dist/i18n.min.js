import*as DataTier from"./data-tier/data-tier.min.js";class e{constructor(e,t,o,n){if(!e)throw new Error(`invalid key param "${e}"`);if("ltr"!==t&&"rtl"!==t)throw new Error(`invalid dir param "${t}" (only "ltr" or "rtl" allowed)`);if(!o||"string"!=typeof o)throw new Error(`invalid lang param "${o}"`);if(!n||"string"!=typeof n)throw new Error(`invalid label param "${n}"`);this.key=e,this.dir=t,this.lang=o,this.label=n,Object.freeze(this)}}const t=[new e("ar","rtl","ar","عربى"),new e("en","ltr","en","English"),new e("he","rtl","he","עברית"),new e("ru","ltr","ru","Русский")],o=new EventTarget,n="localeSet",r="localeApplied",a={},i=Symbol("default.pack.locale");let l,c,f="i18n";export{s as setNamespace,t as locales,u as definePack,d as getActiveLocale,w as setActiveLocale,o as events,n as LOCALE_SET_EVENT,r as LOCALE_APPLIED_EVENT};function s(e){if(!e||"string"!=typeof e)throw new Error(`invalid namespace "${e}"`);e!==f&&(l=DataTier.ties.create(e,l||{}),f=e)}function d(){return c}async function w(e){if(!e)throw new Error(`invalid locale "${e}"`);const i="object"==typeof e?t.find(t=>t===e):t.find(t=>t.key===e);if(!i)throw new Error(`"${e}" unmatchable to any of known locales`);if(!c||c.key!==i.key){const e={now:i,previous:c};c=i,o.dispatchEvent(new CustomEvent(n,{detail:e})),document.documentElement.lang=c.key,document.body.dir=c.dir;const t=[];Object.keys(a).forEach(e=>t.push(y(e))),await Promise.all(t),o.dispatchEvent(new CustomEvent(r,{detail:e}))}}async function u(e,t,o){const n=Object.assign({defaultLocale:"en"},o);if(!e||"string"!=typeof e)throw new Error(`invalid pack key "${e}"`);if(e in a)throw new Error(`key "${e}" is already defined`);if(!t||"object"!=typeof t)throw new Error(`invalid source "${t}"`);if(!Object.keys(t).length)throw new Error(`invalid source "${t}" (no locale keys found, at least one expected)`);t[i]=n.defaultLocale in t?n.defaultLocale:Object.keys(t)[0],a[e]=t,await y(e)}async function y(e){const t=c?c.key:null;try{l||DataTier.ties.create(f),l[e]=t?await async function(e,t){let o=null;const n=a[t];if(n){let r=n[e];if(!r){const o=n[i];r=n[o],console.warn(`no i18n data found for "${e}" of "${t}" pack, fallen back to "${o}"`)}if("object"==typeof r)o=n[e];else if("function"==typeof r)o=await Promise.resolve(r());else if("string"==typeof r){console.info(`fetching i18n data for "${e}" of "${t}" pack from "${r}"...`);try{const a=await fetch(n[e]);if(!a.ok)throw new Error(`unexpected status '${a.status}`);o=await a.json(),n[e]=o}catch(o){console.error(`failed to fetch i18n data for "${e}" of "${t}" from "${r}", error:`,o)}}}else console.warn(`no i18n data found for "${t}" pack`);return o}(t,e):null}catch(o){console.error(`failed to apply i18n data for "${t}" of "${e}" pack, error:`,o)}}w("en");