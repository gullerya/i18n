import*as DataTier from"./data-tier/data-tier.min.js";class e{constructor(e,t,r,o){if(!e)throw new Error(`invalid key param "${e}"`);if("ltr"!==t&&"rtl"!==t)throw new Error(`invalid dir param "${t}" (only "ltr" or "rtl" allowed)`);if(!r||"string"!=typeof r)throw new Error(`invalid lang param "${r}"`);if(!o||"string"!=typeof o)throw new Error(`invalid label param "${o}"`);this.key=e,this.dir=t,this.lang=r,this.label=o,Object.freeze(this)}}const t=[new e("ar","rtl","ar","عربى"),new e("en","ltr","en","English"),new e("he","rtl","he","עברית"),new e("ru","ltr","ru","Русский")],r=new EventTarget,o="localeSet",n="localeApplied",a={},i=Symbol("default.pack.locale");let l,c,f="i18n";export{s as setNamespace,t as locales,u as definePack,d as getActiveLocale,w as setActiveLocale,r as events,o as LOCALE_SET_EVENT,n as LOCALE_APPLIED_EVENT};function s(e){if(!e||"string"!=typeof e)throw new Error(`invalid namespace "${e}"`);e!==f&&(l=DataTier.ties.create(e,l||{}),f=e)}function d(){return c}async function w(e){if(!e)throw new Error(`invalid locale "${e}"`);const i="object"==typeof e?t.find(t=>t===e):t.find(t=>t.key===e);if(!i)throw new Error(`"${e}" unmatchable to any of known locales`);if(!c||c.key!==i.key){const e={current:i,previous:c};c=i,r.dispatchEvent(new CustomEvent(o,{detail:e})),document.documentElement.lang=c.key,document.body.dir=c.dir;const t=[];Object.keys(a).forEach(e=>t.push(y(e))),await Promise.all(t),r.dispatchEvent(new CustomEvent(n,{detail:e}))}}async function u(e,t,r){const o=Object.assign({defaultLocale:"en"},r);if(!e||"string"!=typeof e)throw new Error(`invalid pack key "${e}"`);if(e in a)throw new Error(`key "${e}" is already defined`);if(!t||"object"!=typeof t)throw new Error(`invalid source "${t}"`);if(!Object.keys(t).length)throw new Error(`invalid source "${t}" (no locale keys found, at least one expected)`);t[i]=o.defaultLocale in t?o.defaultLocale:Object.keys(t)[0],a[e]=t,await y(e)}async function y(e){const t=c?c.key:null;try{l||DataTier.ties.create(f),l[e]=t?await async function(e,t){let r=null;const o=a[t];if(o){let n=o[e];if(!n){const r=o[i];n=o[r],console.warn(`no i18n data found for "${e}" of "${t}" pack, fallen back to "${r}"`)}if("object"==typeof n)r=o[e];else if("function"==typeof n)r=await Promise.resolve(n());else if("string"==typeof n){console.info(`fetching i18n data for "${e}" of "${t}" pack from "${n}"...`);try{const a=await fetch(o[e]);if(!a.ok)throw new Error(`unexpected status '${a.status}`);r=await a.json(),o[e]=r}catch(r){console.error(`failed to fetch i18n data for "${e}" of "${t}" from "${n}", error:`,r)}}}else console.warn(`no i18n data found for "${t}" pack`);return r}(t,e):null}catch(r){console.error(`failed to apply i18n data for "${t}" of "${e}" pack, error:`,r)}}w("en");